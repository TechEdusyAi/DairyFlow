Overview & Purpose
App Name (placeholder): Dairy Supply & Delivery System

Purpose:
To facilitate ordering, subscription, and delivery of dairy products (especially milk) within Coimbatore for “daily milk” delivery, and across Tamil Nadu for catalog orders. The system should support three roles — User, Delivery Agent, and Admin — each with distinct functionalities. The same codebase should support both mobile (iOS/Android) and web deployment.

Primary goals:

Enable users to subscribe to daily milk delivery or place one-time orders.

Manage delivery routing and tracking for agents.

Provide an admin dashboard for product/inventory management, orders, agents, billing, and analytics.

Actors & Roles
Role / Actor Description Permissions / Capabilities
User Consumer of dairy products Signup/login, view catalog, subscribe to milk, place orders, view orders & invoices, manage profile & address, track orders
Delivery Agent Person who delivers milk / orders Signup/login, view assigned route/stops, mark deliveries, view task details
Admin Owner / manager Manage products, inventory, customers, agents; assign deliveries; generate invoices; analytics; override controls
Functional Requirements
3.1 Authentication & Users
Signup/login via email & password.

(Optional later) Google Sign-In.

After signup, require profile setup: full name, phone number, address (with latitude/longitude).

Admin accounts created manually (or via a secure interface).

Role assignment: user / agent / admin.

Reset password / forgot password flow.

3.2 Profile & Address Management

User can add/edit default address (line1, area, city, state, pincode, lat, lng).

Ability to add multiple addresses (optional), but one default.

Admin can view and edit user profiles & addresses.

3.3 Products & Inventory

Admin can add / edit / deactivate products: name, unit (e.g. liter, pack), price, is_milk flag, status (active/inactive).

Inventory: track stock quantities per product. Admin can update stock.

Product listing endpoint: only active products shown to users.

3.4 Orders & Catalog

Users can place one-time orders (catalog) of available products to any address within Tamil Nadu.

System must store order header (user_id, address_id, total, status, tracking number, carrier) and order items (product_id, qty, price).

Users can view their order history, status, and tracking info (if applicable).

3.5 Milk Subscription & Deliveries

Users can subscribe to daily or scheduled milk delivery:

Select product (milk), default quantity, days of week, start date.

Billing cycle (weekly or monthly).

Payment mode: prepaid or postpaid.

Edge logic: nightly function expands subscription into subscription_deliveries for next day(s).

Delivery agents get assigned to subscription deliveries.

Users can view upcoming deliveries.

3.6 Delivery Routing & Agent Workflows

Admin (or automated function) runs route optimizer to plan best route for agent(s) based on address locations and depot location.

Agent sees list of stops (ordered by sequence) for the day.

For each stop, agent views delivery details (user, quantity, address).

Agent marks stop as delivered: updates route_stops.status, sets delivered_at, and updates subscription_deliveries.status and delivered_at. Possibly add proof (photo).

(Optional) Real-time tracking: agent’s GPS location shown on map; users see the route progress.

3.7 Billing, Invoices, and Ledger

For postpaid users: after deliveries, generate invoice for period (weekly / monthly).

For prepaid users: maintain prepaid balance; deduct on each delivery.

Admin dashboard: generate invoice entries, ledger entries (payments, charges).

Users can view invoices, pay status.

3.8 Admin Dashboard / Analytics

Customer list with profiles, contact, subscription status, order history.

Agent management: list agents, vehicle details, license number. Admin can edit.

Product / inventory dashboard: stock levels, reorders, sales.

Order management: view all orders, filter by status (pending, out for delivery, delivered, cancelled).

Delivery monitoring: live or historical agent routes, stops, pending deliveries.

Analytics: revenue trends, subscription growth, delivery metrics (time, distance).

3.9 Notifications & Communication (optional / future)

Push notifications to users: order status updates, delivery time windows.

Notifications to agents: new route assignment, changes.

Email notifications for invoices / confirmations.